webpackJsonp([20],{1042:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"hImagePreview",props:{width:{type:Number,default:60},distance:{type:Number,default:10},datas:{type:[Array],default:function(){return[]}},borderRadius:{type:Number,default:3}},data:function(){return{}},methods:{click:function(t,e){this.$emit("click",t,e)},itemStyles:function(t){return{height:this.width+"px",width:this.width+"px","margin-right":this.distance+"px","margin-bottom":this.distance+"px","border-radius":this.borderRadius+"px","background-image":"url("+(t.thumbUrl||t.url)+")"}}},computed:{listStyles:function(){return{"margin-right":"-"+this.distance+"px","margin-bottom":"-"+this.distance+"px"}}}}},1043:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a(793),s=n(i),o=a(1419),r=n(o);e.default={props:{buttonName:{type:String,default:"上传"},action:{type:String,default:""},uploadKey:{type:String,default:"file"},extraData:{type:Object,default:function(){return{}}},headers:{type:Object,default:function(){return{}}},withCookie:{type:Boolean,default:!1}},data:function(){return{uploadLoading:!1,file:""}},methods:{handleFileChange:function(t){this.uploadLoading=!0,void 0===t.target?this.file=t[0]:this.file=t.target.files[0],this.file&&this.request(this.file)},getExtName:function(t){var e=t.name.split(".");return e[e.length-1]},request:function(t){var e=this,a=this.headers,n=this.withCookie,i=this.extraData,o=this.uploadKey,u=this.action,l=JSON.parse((0,s.default)(i)),c={headers:a,withCredentials:n,file:t,data:l,filename:o,action:u,onProgress:function(a){e.uploadPercent=~~a.percent,e.onProgress(a,t)},onSuccess:function(t){e.uploadLoading=!1,e.onSuccess(t)},onError:function(a){e.uploadLoading=!1,e.onError(a,t)}};(0,r.default)(c)},onProgress:function(t,e){},onSuccess:function(t){this.$emit("complete","success",t),this.removeFile()},onError:function(t,e){this.$emit("complete","error",t,e),this.removeFile()},removeFile:function(){document.getElementById("uploadInput").value=""},activeUpload:function(){!1===this.uploadLoading&&document.getElementById("uploadInput").click()}}}},1057:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a(212),s=n(i),o=a(37),r=n(o),u=a(211),l=n(u),c=a(147),d=n(c),p=a(1104),f=n(p),h=a(1260),m=n(h),v=a(223);e.default={components:{ImagePreview:f.default,uploadButton:m.default},data:function(){return{datas:[],uploadAction:d.default.get("origin")+"/api/resource/uploader",uploadData:{token:d.default.get("token")},isNoMore:!1,params:{type:1,pageSize:30,pageNumber:0},panel:{show:!1,index:0,data:""}}},mounted:function(){var t=this;this.fetchData(function(){t.containerLoading=!1})},methods:{panelPreview:function(){this.$ImagePreview(this.datas,this.panel.index)},panelShow:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;arguments[1];this.panel.index=t,this.panel.data=this.datas[this.panel.index],this.panel.show=!0},fetchData:function(t){var e=this;return(0,l.default)(s.default.mark(function a(){var n,i,o,u,l,c;return s.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n=e.params,i=n.type,o=n.pageSize,u=n.pageNumber,e.containerLoading=!0,a.next=4,e.req$.get("/api/resource/list?type="+i+"&pageSize="+o+"&pageNumber="+u);case 4:l=a.sent,c=l.data.list,0===l.code&&(0===u?e.datas=c:0===c.length?e.isNoMore=!0:e.datas=[].concat((0,r.default)(e.datas),(0,r.default)(c))),"function"==typeof t&&t(),(0,v.setTimeout)(function(){e.containerLoading=!1},1e3);case 9:case"end":return a.stop()}},a,e)}))()},deleteImage:function(t){var e=this;this.$Confirm("确定删除？","提醒").then(function(){e.req$.post("/api/resource/delete",{id:e.datas[t]._id,filename:e.datas[t].filename}).then(function(t){e.$Message[0===t.code?"success":"error"](t.msg),e.reload()})}).catch(function(){})},uploadComplete:function(t,e){"success"===t?(this.$Message[0===e.code?"success":"error"](e.msg),0===e.code&&this.reload()):this.$Message.error("未知错误")},reload:function(){var t=this;this.datas=[],this.isNoMore=!1,this.params.pageNumber=0,this.fetchData(function(){t.containerLoading=!1})}}}},1104:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a(1259),i=function(t){return t&&t.__esModule?t:{default:t}}(n);e.default=i.default},1173:function(t,e){},1200:function(t,e){},1203:function(t,e){},1259:function(t,e,a){function n(t){i||a(1173)}var i=!1,s=a(62)(a(1042),a(1280),n,"data-v-130b208a",null);s.options.__file="/Users/apple/Documents/dev/github/jscms/jscms-admin/src/application/components/image-preview/imagepreview.vue",s.esModule&&Object.keys(s.esModule).some(function(t){return"default"!==t&&"__"!==t.substr(0,2)}),s.options.functional,t.exports=s.exports},1260:function(t,e,a){function n(t){i||a(1200)}var i=!1,s=a(62)(a(1043),a(1307),n,"data-v-5c94fac7",null);s.options.__file="/Users/apple/Documents/dev/github/jscms/jscms-admin/src/application/components/upload-button/button.vue",s.esModule&&Object.keys(s.esModule).some(function(t){return"default"!==t&&"__"!==t.substr(0,2)}),s.options.functional,t.exports=s.exports},1280:function(t,e,a){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"h-image-preview-list",style:t.listStyles},t._l(t.datas,function(e,n){return a("div",{key:n,staticClass:"h-image-preview-item",style:t.itemStyles(e),on:{click:function(a){return t.click(n,e)}}},[a("i",{staticClass:"icon h-icon-error",on:{click:function(e){return e.stopPropagation(),t.$emit("close",n)}}})])}),0)},staticRenderFns:[]},t.exports.render._withStripped=!0},1307:function(t,e,a){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"upload-button"},[a("input",{attrs:{id:"uploadInput",type:"file"},on:{change:t.handleFileChange}}),t._v(" "),a("button",{staticClass:"h-btn h-btn-primary",staticStyle:{"z-index":"100"},on:{click:t.activeUpload}},[!0===t.uploadLoading?a("i",{staticClass:"h-icon-loading"}):t._e(),t._v(" "),!1===t.uploadLoading?a("i",{staticClass:"h-icon-upload"}):t._e(),t._v(" "),a("span",[t._v(t._s(t.buttonName))])])])},staticRenderFns:[]},t.exports.render._withStripped=!0},1310:function(t,e,a){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"frame-page images-page"},[a("div",{staticClass:"h-panel"},[a("div",{staticClass:"h-panel-bar"},[a("span",{staticClass:"h-panel-title"},[t._v("图片管理")]),t._v(" "),a("span",{staticStyle:{float:"right"}},[a("upload-button",{attrs:{buttonName:"上传图片",action:t.uploadAction,extraData:t.uploadData},on:{complete:t.uploadComplete}})],1)]),t._v(" "),a("div",{staticClass:"h-panel-body"},[a("ImagePreview",{attrs:{width:80,borderRadius:5,distance:15,datas:t.datas},on:{click:t.panelShow,close:t.deleteImage}}),t._v(" "),a("Loading",{attrs:{text:"Loading",loading:t.containerLoading}}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:0===t.datas.length||!t.datas,expression:"datas.length===0||!datas"}],staticClass:"no-data"},[t._v("没有数据")]),t._v(" "),a("div",{staticClass:"load-more"},[a("button",{staticClass:"h-btn h-btn-primary",class:{"h-btn-loading":!0===t.isNoMore},on:{click:function(){!1===t.isNoMore&&(t.params.pageNumber++,t.fetchData())}}},[!0===t.containerLoading?a("i",{staticClass:"h-icon-loading"}):t._e(),t._v(" "),!1===t.containerLoading?a("i",{staticClass:"h-icon-refresh"}):t._e(),t._v(" "),a("span",[t._v(t._s(!1===t.isNoMore?"加载更多":"没有更多了"))])])])],1)]),t._v(" "),a("Modal",{model:{value:t.panel.show,callback:function(e){t.$set(t.panel,"show",e)},expression:"panel.show"}},[a("div",{attrs:{slot:"header"},slot:"header"},[t._v("图片操作")]),t._v(" "),a("div",{staticClass:"panel"},[a("ul",[a("li",[a("div",{staticClass:"h-input-group"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.panel.data.url,expression:"panel.data.url"}],attrs:{type:"text",placeholder:"内容"},domProps:{value:t.panel.data.url},on:{input:function(e){e.target.composing||t.$set(t.panel.data,"url",e.target.value)}}}),t._v(" "),a("Button",{attrs:{color:"primary"},on:{click:function(){t.$Clipboard({text:t.panel.data.url})}}},[t._v("复制URL")])],1)]),t._v(" "),a("li",[a("button",{staticClass:"h-btn h-btn-block",on:{click:t.panelPreview}},[a("i",{staticClass:"h-icon-search"}),t._v(" "),a("span",[t._v("预览")])])]),t._v(" "),a("li",[a("button",{staticClass:"h-btn h-btn-block",on:{click:function(e){return t.deleteImage(t.panel.index)}}},[a("i",{staticClass:"h-icon-trash"}),t._v(" "),a("span",[t._v("删除")])])])])])])],1)},staticRenderFns:[]},t.exports.render._withStripped=!0},1419:function(t,e,a){"use strict";function n(t,e,a){var n;n=a.response?""+(a.response.error||a.response):a.responseText?""+a.responseText:"fail to post "+t+" "+a.status;var i=new Error(n);return i.status=a.status,i.method="post",i.url=t,i}function i(t){var e=t.responseText||t.response;if(!e)return e;try{return JSON.parse(e)}catch(t){return e}}function s(t){if("undefined"!=typeof XMLHttpRequest){var e=new XMLHttpRequest,a=t.action;e.upload&&(e.upload.onprogress=function(e){e.total>0&&(e.percent=e.loaded/e.total*100),t.onProgress(e)});var s=new FormData;t.data&&Object.keys(t.data).forEach(function(e){s.append(e,t.data[e])}),s.append(t.filename,t.file,t.file.name),e.onerror=function(e){t.onError(e)},e.onload=function(){if(e.status<200||e.status>=300)return t.onError(n(a,t,e));t.onSuccess(i(e))},e.open("post",a,!0),t.withCredentials&&"withCredentials"in e&&(e.withCredentials=!0);var o=t.headers||{};for(var r in o)o.hasOwnProperty(r)&&null!==o[r]&&e.setRequestHeader(r,o[r]);return e.send(s),e}}t.exports=s},576:function(t,e,a){function n(t){i||a(1203)}var i=!1,s=a(62)(a(1057),a(1310),n,"data-v-6b0b453e",null);s.options.__file="/Users/apple/Documents/dev/github/jscms/jscms-admin/src/application/modules/resource/images/list.vue",s.esModule&&Object.keys(s.esModule).some(function(t){return"default"!==t&&"__"!==t.substr(0,2)}),s.options.functional,t.exports=s.exports},793:function(t,e,a){t.exports={default:a(797),__esModule:!0}},797:function(t,e,a){var n=a(21),i=n.JSON||(n.JSON={stringify:JSON.stringify});t.exports=function(t){return i.stringify.apply(i,arguments)}}});