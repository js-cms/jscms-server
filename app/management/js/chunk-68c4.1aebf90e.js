(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-68c4"],{"1bba":function(t,e,a){},"7a8a":function(t,e,a){},"96f5":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[a("template",{slot:"header"},[a("span",[t._v(t._s(t.id?"修改":"新建")+"文章")]),a("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",size:"mini"},on:{click:function(e){t.saveData()}}},[t._v(t._s(t.id?"保存":"发布"))])],1),a("div",{attrs:{clsss:"filter-warp"}},[a("el-form",{attrs:{model:t.article,"label-width":"130px"}},[a("el-form-item",{attrs:{label:"文章分类"}},[a("el-select",{attrs:{placeholder:"选择文章分类"},model:{value:t.article.categoryId,callback:function(e){t.$set(t.article,"categoryId",e)},expression:"article.categoryId"}},t._l(t.categoryList,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.id}})}))],1),a("el-form-item",{attrs:{label:"文章类型"}},[a("el-select",{attrs:{placeholder:"选择文章类型"},model:{value:t.article.type,callback:function(e){t.$set(t.article,"type",e)},expression:"article.type"}},t._l(t.typeOptions,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.id}})}))],1),a("el-form-item",{attrs:{label:"文章封面"}},[a("el-input",{attrs:{placeholder:"填写文章封面地址"},model:{value:t.article.poster,callback:function(e){t.$set(t.article,"poster",e)},expression:"article.poster"}})],1),a("el-form-item",{attrs:{label:"文章标题("+t.article.title.length+")"}},[a("el-input",{attrs:{placeholder:"填写文章标题"},model:{value:t.article.title,callback:function(e){t.$set(t.article,"title",e)},expression:"article.title"}})],1),a("el-form-item",{attrs:{label:"文章关键字("+t.article.keywordsStr.length+")"}},[a("el-input",{attrs:{placeholder:"填写文章关键字"},model:{value:t.article.keywordsStr,callback:function(e){t.$set(t.article,"keywordsStr",e)},expression:"article.keywordsStr"}})],1),a("el-form-item",{attrs:{label:"文章描述("+t.article.description.length+")"}},[a("el-input",{attrs:{type:"textarea",rows:5,placeholder:"填写文章描述/摘要"},model:{value:t.article.description,callback:function(e){t.$set(t.article,"description",e)},expression:"article.description"}})],1)],1)],1),void 0!==t.article.mdContent?a("div",[a("d2-mde",{staticClass:"mde",model:{value:t.article.mdContent,callback:function(e){t.$set(t.article,"mdContent",e)},expression:"article.mdContent"}}),a("el-card",{staticClass:"d2-card",attrs:{shadow:"never"}},[a("d2-markdown",{attrs:{source:t.article.mdContent}})],1)],1):t._e()],2)},i=[],s=(a("7f7f"),a("6bde")),n=(a("ac6a"),a("4f7f"),a("8afe")),l=(a("28a5"),a("96cf"),a("3040")),c=(a("6c7b"),a("0c6d")),o=a("8ded"),d=a.n(o),u={name:"articleEdit",data:function(){return{loading:!0,categoryList:[],typeOptions:[{id:1,name:"单封面"},{id:2,name:"多封面"}],article:{categoryId:"",type:1,poster:"",title:"",keywordsStr:"",keywords:[],description:"",mdContent:void 0},id:this.$route.query.id||""}},watch:{article:{handler:function(){this.article&&(this.article.title||this.article.keywordsStr||this.article.keywords.length||this.article.description||this.article.mdContent)&&(console.log("save",this.article),d.a.set("draft-article",this.article))},deep:!0}},mounted:function(){var t=this;this.getCategory(function(){var e=d.a.get("draft-article");void 0!=e&&null!=e&&""!=e||(e=t.article),t.id?t.id===e._id?t.fill(e):t.getData():(e&&t.fill(e),void 0===t.article.mdContent&&(t.article.mdContent="",t.loaded()))})},methods:{getData:function(){var t=Object(l["a"])(regeneratorRuntime.mark(function t(){var e,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,c["b"].get("/api/article?id=".concat(this.id));case 2:e=t.sent,e.data.data.keywordsStr=e.data.data.keywords.join(","),a=e.data.data,this.fill(a),this.loaded();case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),fill:function(t){this.article=t,this.loaded()},validate:function(){return""===this.article.categoryId?(this.$message.error("请选择文章分类"),!1):""===this.article.type?(this.$message.error("请选择文章类型"),!1):""===this.article.title?(this.$message.error("请填写文章标题"),!1):""===this.article.poster?(this.$message.error("请填写文章封面地址"),!1):""===this.article.keywords?(this.$message.error("请填写文章关键字"),!1):""===this.article.description?(this.$message.error("请填写文章描述"),!1):""===this.article.mdContent?(this.$message.error("请填写文章内容"),!1):void 0},saveData:function(){var t=Object(l["a"])(regeneratorRuntime.mark(function t(){var e,a,r,i,l,o;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.validate(),!1!==e){t.next=3;break}return t.abrupt("return");case 3:if(a={},this.id){t.next=13;break}return r=this.article.keywordsStr.split(","),r=Object(n["a"])(new Set(r)),this.article.keywords=r,t.next=10,c["b"].post("/api/article/create",this.article);case 10:a=t.sent,t.next=19;break;case 13:return i=this.article.keywordsStr.split(","),i=Object(n["a"])(new Set(i)),l={id:this.article._id,categoryId:this.article.categoryId,type:this.article.type,poster:this.article.poster,title:this.article.title,keywords:i,description:this.article.description,mdContent:this.article.mdContent},t.next=18,c["b"].post("/api/article/update",l);case 18:a=t.sent;case 19:o=a.data.msg,1===a.data.code?"object"===Object(s["a"])(o)?this.$message.error(JSON.stringify(o)):this.$message.error(o):(this.$message.success(o),this.closeMe());case 21:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),getCategory:function(){var t=Object(l["a"])(regeneratorRuntime.mark(function t(e){var a,r,i;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,c["b"].get("/api/category/list");case 2:a=t.sent,r=[],i=a.data.data,i.forEach(function(t){r.push({id:t._id,name:t.name})}),this.categoryList=r,"function"===typeof e&&e();case 8:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),closeMe:function(){var t=this;d.a.set("draft-article",null),setTimeout(function(){t.$store.dispatch("d2admin/page/close",{tagName:"article-edit",vm:t})},1e3)},loaded:function(){var t=this;setTimeout(function(){t.loading=!1},1e3)}}},p=u,h=(a("a75f"),a("ff77"),a("2877")),f=Object(h["a"])(p,r,i,!1,null,"2fb3919e",null);f.options.__file="edit.vue";e["default"]=f.exports},a75f:function(t,e,a){"use strict";var r=a("7a8a"),i=a.n(r);i.a},ff77:function(t,e,a){"use strict";var r=a("1bba"),i=a.n(r);i.a}}]);
//# sourceMappingURL=chunk-68c4.1aebf90e.js.map